The mDirac Mex extension
========================
Marc Joliet <marcec@gmx.de>

Introduction
------------

This document explains how to compile mDirac.

mDirac is a mex wrapper for the time-stretching/pitch-shifting C++ library
Dirac, written by Stephan Bernsee of http://www.dspdimension.com[].  It works
with Matlab arrays of arbitrary MxN dimension, M being the number of samples per
channel and N being the number of channels, as returned by, e.g., 'wavread()'.

Compiling
---------

There are 2 ways to compile mDirac.  The easy way is to call the m-file
'compile_timestretch.m' from Matlab.  There is also a more flexible build system
based on SCons available, though it is perhaps overblown for a project of this
size.  It has, however, proven that a proper and robust cross-platform build
system for Mex extensions is possible.  For details to both methods, see their
relevant subsections.

A problem of all methods of compilation is that at least two things are not
implemented.  For one thing: installing.  It is expected that you copy the
resulting Mex binaries to wherever your Matlab installation looks for them.

Prerequisites
~~~~~~~~~~~~~

mDirac has no external dependencies as the DiracLE library is bundled.

Using the compile_timestretch.m script (all platforms)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In Matlab, type 'compile_timestretch'.  This will compile both Mex extensions
and run a test script.

Using the SCons based build system
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The SCons based build system is in general more robust and flexibel than just
calling Mex, like in 'compile_timestretch.m'.  It comes with an extension that
properly presets a few environment variables, though it slows compilation down
because it starts a Matlab subprocess to obtain them.  If you need to work on
the Code and plan to compile often, you can use the interactive mode by passing
the '--interactive' option to SCons, so that the command line would look like

--------------------------------------
scons --interactive [options] [target]
--------------------------------------

Linux
^^^^^

Just open a terminal and type

-----------------
    $ scons
-----------------

while in the source directory.  Users with 32 bit Matlab on 64 bit systems
should pass the --linux32 option to enforce 32 bit compilation.

Windows
^^^^^^^

If SCons is in your PATH, you can open a console and follow the steps under
Linux.  The '--make-msvs' option creates a MS VisualStudio Solution file with
mDirac as a project.  For other IDEs, see
http://www.scons.org/wiki/IDEIntegration[].

Mac OS X
^^^^^^^^

Follow the same steps as under Linux, or look into integrating SCons into your
IDE of choice (see http://www.scons.org/wiki/IDEIntegration[]).

Copyrights
----------

For the copyrights to mDirac and the SCons Matlab tool, see the file LICENSE.

DIRAC Time Stretch/Pitch Shift technology (c) 2005-2009 Stephan M. Bernsee,
http://www.dspdimension.com[].
